package registrationPage;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/caloriesServlet")
public class caloriesServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    @Override
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        Map<String, Integer> calorieMap = new HashMap<>();
        calorieMap.put("aandw restaurantroot beer float", 224);
        calorieMap.put("aandw restaurantdiet root beer float", 564);
        calorieMap.put("aandw restaurantroot beer freeze", 250);
        calorieMap.put("aandw restaurantchocolate shake", 1370);
        calorieMap.put("aandw restaurantstrawberry shake", 944);
        calorieMap.put("aandw restaurantdiet root beer freeze", 873);
        calorieMap.put("aandw restaurantvanilla shake", 543);
        calorieMap.put("aandw restaurantchicken strips 5 pieces", 943);
        calorieMap.put("aandw restaurantchicken tender 1 piece", 435);
        calorieMap.put("aandw restaurantvanilla soft serve cone regular", 108);
        calorieMap.put("aandw restaurantmandms polar swirl", 371);

        int totalCalories = 0;

        for (String category : request.getParameterMap().keySet()) {
            String[] selectedFoods = request.getParameterValues(category + "Foods[]");
            if (selectedFoods != null) {
                for (String food : selectedFoods) {
                    totalCalories += calorieMap.get(food);
                }
            }
        }

        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();

        out.println("<html><head><title>Total Calories</title></head><body>");
        out.println("<h2>Total Calories: " + totalCalories + "</h2>");
        out.println("<br><a href='javascript:history.back()'>Go Back</a>");
        out.println("</body></html>");
    }

    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();

        // Display the form with meal categories and food items
        // Add JavaScript to hide the food list when an item is selected
        out.println("<html><head><title>Calorie Counter</title>");
        out.println("<script src='https://code.jquery.com/jquery-3.6.0.min.js'></script>");
        out.println("<style>.foodList { display: none; position: absolute; background: #f9f9f9; border: 1px solid #ccc; max-height: 200px; overflow-y: scroll; }</style>");
        out.println("</head><body>");

        // Your existing code for displaying meal categories and food items

        out.println("<script>");
        out.println("$(document).ready(function() {");
        out.println("$('input[type=checkbox]').change(function() {");
        out.println("$(this).closest('.foodList').hide();");
        out.println("});");
        out.println("});");
        out.println("</script>");

        out.println("</body></html>");
    }
}